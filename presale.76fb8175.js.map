{"mappings":"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","sources":["src/js/referralHandler.js"],"sourcesContent":["\r\n// const copyReferLinkBtn = document.getElementById(\"refer-link-icon\");\r\nconst copyReferLinkBtns = document.querySelectorAll(\".refer-link\");\r\n// async function populateReferrerOf(userAddress) {\r\nasync function populateReferrerLinkinHTML(userAddress) {\r\n    const defaultReferrer = '0x0000000000000000000000000000000000000000';\r\n\r\n    let referrerValue = userAddress; //which will be 'logged out' if user is logged out\r\n    // if user is logged-in we change the value of refferValue\r\n    if (isUserConnected()) referrerValue = await getReferrer(userAddress);\r\n    // show referrer value only if it's not default : i.e. something other than 0x00...0\r\n    if (referrerValue !== defaultReferrer) {\r\n        const referrerFields = document.querySelectorAll('.refer-referrer');\r\n        const referrerFieldsContainer = document.querySelectorAll('.refer-referrer-container');\r\n        referrerFieldsContainer && referrerFieldsContainer.forEach(el => {\r\n            el.classList.remove('hidden');\r\n        });\r\n        referrerFields && referrerFields.forEach(el => {\r\n            // in this example - the userAddress = logged out\r\n            el.innerHTML = referrerValue;\r\n        });\r\n    }\r\n\r\n    // uncomment the below line - to check if the addReferrerBtn will show when the reffere is 0x00...00 or not\r\n    // referrerValue = '0x0000000000000000000000000000000000000000'\r\n    /**\r\n     * if referrer is 0x0000000000000000000000000000000000000000\r\n     * then show the ability to change / setReferrer\r\n     * else keep it hidden\r\n     */\r\n    const setRefferrerBtn = document.querySelector('#add-referrer');\r\n    if (setRefferrerBtn) {\r\n        if (referrerValue === defaultReferrer) setRefferrerBtn.classList.remove('hidden')\r\n        else setRefferrerBtn.classList.add('hidden')\r\n    }\r\n}\r\n\r\n\r\nasync function getReferrer(userAddress) {\r\n    const ABI_getReferrer = [{ \"inputs\": [{ \"internalType\": \"address\", \"name\": \"_user\", \"type\": \"address\" }], \"name\": \"getReferrer\", \"outputs\": [{ \"internalType\": \"address\", \"name\": \"\", \"type\": \"address\" }], \"stateMutability\": \"view\", \"type\": \"function\" }];\r\n\r\n    let options = {\r\n        contractAddress: REFER_CONTRACT_ADDRESS_TESTNET,\r\n        functionName: 'getReferrer',\r\n        abi: ABI_getReferrer,\r\n        params: {\r\n            _user: userAddress,\r\n        }\r\n    }\r\n\r\n    return await Moralis.executeFunction(options);\r\n}\r\n\r\nasync function populateUserReferralsCount(userAddress) {\r\n    let countValue = userAddress; //which will be 'logged out' if user is logged out\r\n    // if user is logged-in we change the value of refferValue\r\n    if (isUserConnected()) countValue = await getReferralsCount(userAddress);\r\n    const referrerFields = document.querySelectorAll('.refer-total');\r\n    referrerFields && referrerFields.forEach(el => {\r\n        // in this example - the countValue = 0\r\n        el.innerHTML = countValue;\r\n    });\r\n}\r\n\r\n// //the address with with Referrer not 0x000 (provided by Jagjeet)\r\n// const addressWithReferrerNot0x000 = '0x0B277AbA422fD3d1e38e93aFfe684B68fc001647'\r\n\r\nasync function getReferralsCount(userAddress) {\r\n    const ABI_referralsCount = [{ \"inputs\": [{ \"internalType\": \"address\", \"name\": \"_userReferralsCount\", \"type\": \"address\" }], \"name\": \"getReferralsCount\", \"outputs\": [{ \"internalType\": \"uint256\", \"name\": \"\", \"type\": \"uint256\" }], \"stateMutability\": \"view\", \"type\": \"function\" }];\r\n\r\n    // //the address with count=1 (provided by Jagjeet)\r\n    // userAddress = '0x361c26aDc02Ade99735E2A7F38606F2ec56cc1B0';\r\n\r\n    let options = {\r\n        contractAddress: REFER_CONTRACT_ADDRESS_TESTNET,\r\n        functionName: 'getReferralsCount',\r\n        abi: ABI_referralsCount,\r\n        params: {\r\n            _userReferralsCount: userAddress,\r\n        }\r\n    }\r\n\r\n    let r = ''\r\n    try {\r\n        r = await Moralis.executeFunction(options);\r\n    } catch (error) {\r\n        r = 'error-ln99-app'\r\n        console.error(error);\r\n    }\r\n\r\n    return r\r\n}\r\n\r\nasync function addReferrer() {\r\n    const referrerAddress = document.querySelector('#add-referrer-address');\r\n    const errContainer = document.querySelector('#add-referrer-err');\r\n    const errMsgContainer = document.querySelector('#add-referrer-msg');\r\n    // let refAdd = referrerAddress.value + '';\r\n    // refAdd = refAdd.toLowerCase();\r\n\r\n    if (!referrerAddress.value) {\r\n        showErrMsg(errContainer, errMsgContainer, 'Empty Field!');\r\n        return;\r\n    } else if (referrerAddress.value.length <= 6) {\r\n        showErrMsg(errContainer, errMsgContainer, 'Invalid Address!');\r\n        return;\r\n    }\r\n    // at this point the refer address isn't empty and length is > 6 characters\r\n\r\n    try {\r\n        let result = await setReferAddress(referrerAddress.value);\r\n        // let result = await setReferAddress(refAdd);\r\n        populateReferrerLinkinHTML(getUserWalletAddress());\r\n        console.log(result);\r\n\r\n    } catch (error) {\r\n        console.error(error);\r\n        showErrMsg(errContainer, errMsgContainer, 'Invalid Address!!!');\r\n    }\r\n}\r\nasync function setReferAddress(referrerAddress) {\r\n\r\n    const ABI_totalReferralCommissions = [{ \"inputs\": [{ \"internalType\": \"address\", \"name\": \"referAddress\", \"type\": \"address\" }], \"name\": \"addReferAddress\", \"outputs\": [], \"stateMutability\": \"nonpayable\", \"type\": \"function\" }];\r\n    console.log(`setReferAddress to - ${referrerAddress}`);\r\n    let options = {\r\n        contractAddress: REFER_CONTRACT_ADDRESS_TESTNET,\r\n        functionName: 'addReferAddress',\r\n        abi: ABI_totalReferralCommissions,\r\n        params: {\r\n            referAddress: referrerAddress,\r\n        }\r\n    }\r\n\r\n    let transaction;\r\n    try {\r\n        transaction = await Moralis.executeFunction(options);\r\n    } catch (error) {\r\n        console.error(error);\r\n    }\r\n\r\n    return await transaction.wait();\r\n}\r\n\r\nasync function populateUserReferralComissions(userAddress) {\r\n    let commissionValue = userAddress; //which will be 'logged out' if user is logged out\r\n    // if user is logged-in we change the value of refferValue\r\n    if (isUserConnected()) commissionValue = await getTotalReferralCommissions(userAddress);\r\n    commissionValue = commissionValue / Math.pow(10, 9);\r\n\r\n    const commssionFields = document.querySelectorAll('.refer-earning');\r\n    commssionFields && commssionFields.forEach(el => {\r\n        // in this example - the countValue = 0\r\n        el.innerHTML = `${commissionValue} IBAT`;\r\n    });\r\n}\r\n\r\nasync function getTotalReferralCommissions(userAddress) {\r\n    const ABI_totalReferralCommissions = [{ \"inputs\": [{ \"internalType\": \"address\", \"name\": \"_userCommission\", \"type\": \"address\" }], \"name\": \"getTotalReferralCommissions\", \"outputs\": [{ \"internalType\": \"uint256\", \"name\": \"\", \"type\": \"uint256\" }], \"stateMutability\": \"view\", \"type\": \"function\" }];\r\n    let options = {\r\n        contractAddress: REFER_CONTRACT_ADDRESS_TESTNET,\r\n        functionName: 'getTotalReferralCommissions',\r\n        abi: ABI_totalReferralCommissions,\r\n        params: {\r\n            _userCommission: userAddress,\r\n        }\r\n    }\r\n    return await Moralis.executeFunction(options);\r\n}\r\n\r\nfunction copyReferLink() {\r\n    // get the referralLink\r\n    /**\r\n        if user logged in - show the box \r\n        else nothing OR hide the box at logout\r\n    * \r\n    */\r\n    let userAddress = getUserWalletAddress();\r\n    // store it in variable\r\n    const URL_Prefix = 'https://battleinfinstg.wpengine.com/BattleTeam/dapp.php?refercode='\r\n    let USER_RefferalLink = `${URL_Prefix}${userAddress}`;\r\n    populateReferralLinkinHTML(USER_RefferalLink);\r\n\r\n    navigator.clipboard.writeText(USER_RefferalLink);\r\n\r\n    // console.log(`copied`);\r\n    // populateReferralLinkinHTML('bkahsasdasd');\r\n}\r\nfunction populateReferralLinkinHTML(referralLink) {\r\n    const linkNodes = document.querySelectorAll('.refer-link-text');\r\n    linkNodes && linkNodes.forEach(el => {\r\n        el.innerHTML = referralLink;\r\n    });\r\n}\r\n// copyReferLinkBtn.onclick = copyReferLink;\r\ncopyReferLinkBtns.forEach(el => (el.onclick = copyReferLink))\r\n"],"names":["copyReferLinkBtns","document","querySelectorAll","populateReferrerLinkinHTML","userAddress","defaultReferrer","referrerValue","isUserConnected","getReferrer","referrerFields","referrerFieldsContainer","forEach","el","classList","remove","innerHTML","setRefferrerBtn","add","options","REFER_CONTRACT_ADDRESS_TESTNET","functionName","abi","internalType","name","type","stateMutability","params","_user","Moralis","executeFunction","populateUserReferralsCount","countValue","getReferralsCount","_userReferralsCount","r","error","addReferrer","referrerAddress","querySelector","errContainer","errMsgContainer","value","length","showErrMsg","result","setReferAddress","getUserWalletAddress","console","log","transaction","outputs","referAddress","wait","populateUserReferralComissions","commissionValue","getTotalReferralCommissions","Math","pow","commssionFields","_userCommission","copyReferLink","USER_RefferalLink","navigator","clipboard","writeText"],"version":3,"file":"presale.76fb8175.js.map"}